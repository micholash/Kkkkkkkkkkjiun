<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì•¼ìƒì˜ ë¹„ë‘˜ê¸° í‚¤ìš°ê¸°</title>
    <style>
        /* --- CSS ìŠ¤íƒ€ì¼ --- */
        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background-color: #87CEEB;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            touch-action: none; /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        .header {
            text-align: center;
            margin-top: 15px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            z-index: 100;
            pointer-events: none; /* í´ë¦­ í†µê³¼ */
        }

        h1 { margin: 5px 0; font-size: 24px; }
        .score-board { font-size: 14px; background: rgba(0,0,0,0.3); padding: 5px 12px; border-radius: 15px; display: inline-block;}

        /* ììœ  ê²Œì„ ì˜ì—­ (ë“¤íŒ) */
        #game-area {
            position: relative;
            flex-grow: 1;
            width: 100%;
            background-color: #C5E1A5;
            background-image: 
                radial-gradient(circle at 10% 20%, #AED581 5%, transparent 5%),
                radial-gradient(circle at 90% 80%, #AED581 5%, transparent 5%);
            overflow: hidden;
            touch-action: none;
        }

        /* ë¹„ë‘˜ê¸° ì•„ì´í…œ */
        .item {
            position: absolute;
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            touch-action: none;
            z-index: 10;
            user-select: none;
        }

        /* ë“œë˜ê·¸ ì¤‘ íš¨ê³¼ */
        .item.dragging {
            opacity: 0.8;
            z-index: 1000;
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            cursor: grabbing;
        }

        .item .emoji { font-size: 32px; line-height: 1; pointer-events: none; }
        .item .level { font-size: 11px; color: #555; font-weight: bold; margin-top: 2px; pointer-events: none; }

        /* ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pop {
            0% { transform: scale(0) rotate(-30deg); }
            80% { transform: scale(1.1) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        .pop-anim { animation: pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */
        .controls {
            padding: 15px;
            width: 100%;
            box-sizing: border-box;
            background: rgba(255,255,255,0.9);
            z-index: 100;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .spawn-btn {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            background-color: #FF9800;
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 0 #F57C00;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .spawn-btn:active { transform: translateY(4px); box-shadow: none; }

    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ•Šï¸ ì•¼ìƒì˜ ë¹„ë‘˜ê¸°</h1>
        <div class="score-board">
            ìµœê³ : <span id="max-level-name">ì—†ìŒ</span> (Lv.<span id="max-level">0</span>)
        </div>
    </div>

    <div id="game-area">
        <!-- ë¹„ë‘˜ê¸°ë“¤ì´ ì—¬ê¸°ì„œ ë›°ì–´ë†€ì•„ìš” -->
    </div>

    <div class="controls">
        <button class="spawn-btn" id="spawnBtn">
            ğŸ¥š ì•Œ ë‚³ê¸° (Click)
        </button>
    </div>

    <script>
        // --- 20ë‹¨ê³„ ë¹„ë‘˜ê¸° ë„ê° ---
        const pigeonTypes = [
            { level: 1, emoji: "ğŸ¥š", name: "ë¹„ë‘˜ê¸° ì•Œ" },
            { level: 2, emoji: "ğŸ£", name: "ê¹¨ì§„ ì•Œ" },
            { level: 3, emoji: "ğŸ¥", name: "ì•„ê¸° ìƒˆ" },
            { level: 4, emoji: "ğŸ¦", name: "ë¹„ë‘˜ê¸°" },
            { level: 5, emoji: "ğŸ¥–", name: "ë¹µë‘˜ê¸°" },
            { level: 6, emoji: "ğŸ”", name: "ë‹­ë‘˜ê¸°" },
            { level: 7, emoji: "ğŸ¦œ", name: "ì•µë¬´ë‘˜ê¸°" },
            { level: 8, emoji: "ğŸ¦¢", name: "ë°±ì¡°ë‘˜ê¸°" },
            { level: 9, emoji: "ğŸ¦©", name: "í™í•™ë‘˜ê¸°" },
            { level: 10, emoji: "ğŸ¦š", name: "ê³µì‘ë‘˜ê¸°" },
            { level: 11, emoji: "ğŸ¦‰", name: "ë¶€ì—‰ë‘˜ê¸°" },
            { level: 12, emoji: "ğŸ¦…", name: "ë…ìˆ˜ë¦¬" },
            { level: 13, emoji: "ğŸ¦†", name: "ì˜¤ë¦¬ë‘˜ê¸°" },
            { level: 14, emoji: "ğŸ¦‡", name: "ë°•ì¥ë‘˜ê¸°" },
            { level: 15, emoji: "ğŸ‰", name: "ìš©ë‘˜ê¸°" },
            { level: 16, emoji: "âœˆï¸", name: "ì „íˆ¬ê¸°" },
            { level: 17, emoji: "ğŸš", name: "í—¬ê¸°" },
            { level: 18, emoji: "ğŸš€", name: "ë¡œì¼“" },
            { level: 19, emoji: "ğŸ›¸", name: "UFO" },
            { level: 20, emoji: "ğŸª", name: "ìš°ì£¼ì‹ " }
        ];

        const gameArea = document.getElementById('game-area');
        const maxLevelSpan = document.getElementById('max-level');
        const maxLevelNameSpan = document.getElementById('max-level-name');
        const spawnBtn = document.getElementById('spawnBtn');

        let highestLevel = 0;
        let activeItem = null;
        let startX = 0, startY = 0; // ë“œë˜ê·¸ ì‹œì‘ ì‹œ ë§ˆìš°ìŠ¤-ì•„ì´í…œ ê°„ê²©
        let initialPos = { x: 0, y: 0 }; // ì›ë˜ ìœ„ì¹˜ (ë˜ëŒì•„ê°€ê¸°ìš©)
        const ITEM_SIZE = 70; // ì•„ì´í…œ í¬ê¸°

        // --- 1. ëœë¤ ìœ„ì¹˜ ê³„ì‚° ---
        function getRandomPosition() {
            const areaWidth = gameArea.clientWidth;
            const areaHeight = gameArea.clientHeight;
            // í™”ë©´ ë°–ìœ¼ë¡œ ì•ˆ ë‚˜ê°€ê²Œ ì—¬ë°± ì¤Œ
            const x = Math.random() * (areaWidth - ITEM_SIZE);
            const y = Math.random() * (areaHeight - ITEM_SIZE);
            return { x, y };
        }

        // --- 2. ì•„ì´í…œ ìƒì„± ---
        function createItem(level, x = null, y = null) {
            const data = pigeonTypes[level - 1];
            const item = document.createElement('div');
            item.classList.add('item');
            item.dataset.level = level;

            // ì¢Œí‘œ ì„¤ì •
            const pos = (x === null || y === null) ? getRandomPosition() : { x, y };
            item.style.left = `${pos.x}px`;
            item.style.top = `${pos.y}px`;

            item.innerHTML = `<div class="emoji">${data.emoji}</div><div class="level">Lv.${level}</div>`;
            
            // ì• ë‹ˆë©”ì´ì…˜
            item.classList.add('pop-anim');
            item.addEventListener('animationend', () => item.classList.remove('pop-anim'));

            // í¬ì¸í„° ì´ë²¤íŠ¸ ì—°ê²° (ë§ˆìš°ìŠ¤/í„°ì¹˜ í†µí•©)
            item.addEventListener('pointerdown', handlePointerDown);
            
            gameArea.appendChild(item);
            updateScore(level);
        }

        // --- 3. ë²„íŠ¼ í´ë¦­ ---
        spawnBtn.addEventListener('click', () => {
            if (document.querySelectorAll('.item').length >= 50) {
                alert("ë¹„ë‘˜ê¸°ê°€ ë„ˆë¬´ ë§ì•„ìš”! í•©ì³ì£¼ì„¸ìš”.");
                return;
            }
            createItem(1);
        });

        // --- 4. ë“œë˜ê·¸ ë¡œì§ (í•µì‹¬) ---
        function handlePointerDown(e) {
            e.preventDefault();
            activeItem = e.currentTarget;
            
            // í˜„ì¬ ìœ„ì¹˜ ì €ì¥ (ì‹¤íŒ¨ ì‹œ ë³µê·€ìš©)
            initialPos.x = parseFloat(activeItem.style.left);
            initialPos.y = parseFloat(activeItem.style.top);
            
            // í„°ì¹˜í•œ ì§€ì ê³¼ ì•„ì´í…œ ì™¼ìª½ìƒë‹¨ì˜ ê±°ë¦¬ ì°¨ì´ ê³„ì‚°
            const rect = activeItem.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;

            activeItem.classList.add('dragging');
            activeItem.setPointerCapture(e.pointerId); // í¬ì¸í„° ê°€ë‘ê¸°

            activeItem.addEventListener('pointermove', handlePointerMove);
            activeItem.addEventListener('pointerup', handlePointerUp);
        }

        function handlePointerMove(e) {
            if (!activeItem) return;
            e.preventDefault();

            // ë¶€ëª¨(game-area) ê¸°ì¤€ ì¢Œí‘œ ê³„ì‚°
            const areaRect = gameArea.getBoundingClientRect();
            let newX = e.clientX - areaRect.left - startX;
            let newY = e.clientY - areaRect.top - startY;

            // í™”ë©´ ë°– ì œí•œ
            newX = Math.max(0, Math.min(newX, gameArea.clientWidth - ITEM_SIZE));
            newY = Math.max(0, Math.min(newY, gameArea.clientHeight - ITEM_SIZE));

            activeItem.style.left = `${newX}px`;
            activeItem.style.top = `${newY}px`;
        }

        function handlePointerUp(e) {
            if (!activeItem) return;
            
            activeItem.removeEventListener('pointermove', handlePointerMove);
            activeItem.removeEventListener('pointerup', handlePointerUp);
            activeItem.classList.remove('dragging');
            activeItem.releasePointerCapture(e.pointerId);

            // ì¶©ëŒ ì²´í¬
            const targetItem = findCollidingItem(activeItem);

            if (targetItem) {
                const level1 = parseInt(activeItem.dataset.level);
                const level2 = parseInt(targetItem.dataset.level);

                if (level1 === level2 && level1 < 20) {
                    // [í•©ì„± ì„±ê³µ]
                    const newX = parseFloat(targetItem.style.left);
                    const newY = parseFloat(targetItem.style.top);
                    
                    activeItem.remove();
                    targetItem.remove();
                    createItem(level1 + 1, newX, newY);
                } else {
                    // [í•©ì„± ì‹¤íŒ¨] ë‹¤ë¥¸ ë ˆë²¨ì´ë©´ ì›ë˜ ìë¦¬ë¡œ
                    returnToInitialPos(activeItem);
                }
            } else {
                // [ë¹ˆ ê³µê°„] ê·¸ëƒ¥ ê±°ê¸°ì— ë‘  (ì•„ë¬´ê²ƒë„ ì•ˆ í•¨)
            }

            activeItem = null;
        }

        // ì¶©ëŒ ê°ì§€ í•¨ìˆ˜
        function findCollidingItem(currentItem) {
            const currentRect = currentItem.getBoundingClientRect();
            const currentCenter = { 
                x: currentRect.left + currentRect.width/2, 
                y: currentRect.top + currentRect.height/2 
            };

            const items = document.querySelectorAll('.item');
            for (const item of items) {
                if (item === currentItem) continue;

                const rect = item.getBoundingClientRect();
                const itemCenter = { 
                    x: rect.left + rect.width/2, 
                    y: rect.top + rect.height/2 
                };

                // ë‘ ì  ì‚¬ì´ ê±°ë¦¬
                const dist = Math.sqrt(
                    Math.pow(currentCenter.x - itemCenter.x, 2) + 
                    Math.pow(currentCenter.y - itemCenter.y, 2)
                );

                // ê±°ë¦¬ 50px ì´ë‚´ë©´ ì¶©ëŒë¡œ ê°„ì£¼
                if (dist < 50) { 
                    return item;
                }
            }
            return null;
        }

        function returnToInitialPos(item) {
            item.style.transition = 'all 0.2s ease-out';
            item.style.left = `${initialPos.x}px`;
            item.style.top = `${initialPos.y}px`;
            setTimeout(() => { item.style.transition = ''; }, 200);
        }

        function updateScore(level) {
            if (level > highestLevel) {
                highestLevel = level;
                const data = pigeonTypes[level - 1];
                maxLevelSpan.innerText = level;
                maxLevelNameSpan.innerText = data.name;
            }
        }
        
        // ì‹œì‘ ì‹œ ì•Œ 3ê°œ ì œê³µ
        setTimeout(() => {
            createItem(1);
            createItem(1);
            createItem(1);
        }, 100);

    </script>
</body>
</html>
